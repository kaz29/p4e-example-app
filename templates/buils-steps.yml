steps:
  - task: Docker@1
    displayName: 'Build an image'
    inputs:
      azureSubscriptionEndpoint: $(SubscriptionName)
      azureContainerRegistry: '$(RepositoryName).azurecr.io'
      arguments: '--build-arg HTPASSWD=$(HTPASSWD)'
      imageName: 'p4eexampleapp:$(Build.BuildId)'

  - task: Docker@1
    displayName: 'Push an image'
    inputs:
      azureSubscriptionEndpoint: $(SubscriptionName)
      azureContainerRegistry: '$(RepositoryName).azurecr.io'
      command: 'Push an image'
      imageName: 'p4eexampleapp:$(Build.BuildId)'

  - task: CopyFiles@2
    displayName: 'Copy ARM templates'
    inputs:
      SourceFolder: ArmTemplates
      TargetFolder: '$(build.artifactstagingdirectory)'

  - task: PublishBuildArtifacts@1
    displayName: 'Publish Artifact'
    inputs:
      PathtoPublish: '$(build.artifactstagingdirectory)'

